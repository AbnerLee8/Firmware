/*******************************************************************************
  File Name:
    app_dsp.c

  Summary:
    DSP task. ADAU1860 codec interface.

  Description:
 *******************************************************************************/
#include "app_dsp.h"

//#define DSP_DEBUGGER_ATTACHED
//#define MICROPHONE_TESTING

// .............................................................................
// DSP firmware uploads to different areas 
// .............................................................................
#define FDSP_BASE       0x40008000
#define EQ_BASE         0x4000A000
#define TDSP_IRAM_BASE  0x5FFF8000

const uint8_t eq_firmware[256] = {
    0x55, 0xAA, 0xCC, 0x33, 0,
};

uint8_t eq_buf[256];
extern void debug_dump_output(uint8_t *buf, int len);

// .............................................................................

static uint8_t dsp_wrbuf[256+6];
static uint8_t dsp_rdbuf[256+6];


#ifdef MICROPHONE_TESTING

static uint8_t dsp_anc_mode = DMICS_ALL_OFF;

#else

static uint8_t dsp_anc_mode = DSP_ANC_MODE_UNDEFINED;

#endif // MICROPHONE_TESTING

#include <stdint.h>

// .............................................................................
// Initial settings to be written to the DSP
// reg_pre: write these first
//  reg_pr               write these pre-memory registers first
//  fdsp_program
//  fdsp_param_bank_a
//  fdsp_param_bank_b
//  fdsp_param_bank_c
//  reg_post             write these post-memory registers last
//
// The register values below are generated from Lark Studio software 
// applciation, according to how the audio filters etc. are set up.
// .............................................................................

// .............................................................................

#ifdef MICROPHONE_TESTING

// dsp_programme_es20_mic_test_1_regs

// pre-memory registers
uint32_t reg_pre[283][2] =
{
    {0x4000c051, 0x00000044}, /* DAC_CTRL2 */
	{0x4000c052, 0x000000FD}, /* DAC_VOL0 */
	{0x4000c004, 0x00000000}, /* ADC_DAC_HP_PWR */
	{0x4000c01c, 0x00000093}, /* CLK_CTRL13 */
	{0x4000c005, 0x00000002}, /* PLL_PGA_PWR */
	{0x4000c00e, 0x00000003}, /* CHIP_PWR */
	{0x4000c00e, 0x00000013}, /* CHIP_PWR */
	{0x4000c005, 0x00000003}, /* PLL_PGA_PWR */
	{0x4000c010, 0x000000C8}, /* CLK_CTRL1 */
	{0x4000c011, 0x00000000}, /* CLK_CTRL2 */
	{0x4000c012, 0x00000004}, /* CLK_CTRL3 */
	{0x4000c013, 0x00000000}, /* CLK_CTRL4 */
	{0x4000c014, 0x00000000}, /* CLK_CTRL5 */
	{0x4000c015, 0x00000000}, /* CLK_CTRL6 */
	{0x4000c016, 0x00000000}, /* CLK_CTRL7 */
	{0x4000c017, 0x00000000}, /* CLK_CTRL8 */
	{0x4000c019, 0x000000C0}, /* CLK_CTRL10 */
	{0x4000c01a, 0x00000000}, /* CLK_CTRL11 */
	{0x4000c01b, 0x00000000}, /* CLK_CTRL12 */
	{0x4000c01c, 0x00000013}, /* CLK_CTRL13 */
	{0x4000c01d, 0x000000FF}, /* CLK_CTRL14 */
	{0x4000c01e, 0x000000FF}, /* CLK_CTRL15 */
	{0x4000c018, 0x00000001}, /* CLK_CTRL9 */
	{0x4000c018, 0x00000001}, /* CLK_CTRL9 */
	{0x4000c008, 0x00000001}, /* DSP_PWR */
	{0x4000c006, 0x0000003F}, /* DMIC_PWR */
	{0x4000c007, 0x000000FF}, /* SAI_CLK_PWR */
	{0x4000c009, 0x000000FF}, /* ASRC_PWR */
	{0x4000c00a, 0x0000000F}, /* FINT_PWR */
	{0x4000c00b, 0x0000000F}, /* FDEC_PWR */
	{0x4000c00c, 0x00000001}, /* KEEP_CM */
	{0x4000c00d, 0x00000000}, /* MEM_RETAIN */
	{0x4000c020, 0x00000022}, /* ADC_CTRL1 */
	{0x4000c021, 0x00000000}, /* ADC_CTRL2 */
	{0x4000c022, 0x00000000}, /* ADC_CTRL3 */
	{0x4000c023, 0x00000000}, /* ADC_CTRL4 */
	{0x4000c024, 0x00000040}, /* ADC_CTRL5 */
	{0x4000c025, 0x00000086}, /* ADC_CTRL6 */
	{0x4000c026, 0x00000000}, /* ADC_CTRL7 */
	{0x4000c027, 0x00000000}, /* ADC_MUTES */
	{0x4000c028, 0x00000040}, /* ADC0_VOL */
	{0x4000c029, 0x00000040}, /* ADC1_VOL */
	{0x4000c02a, 0x000000A3}, /* ADC2_VOL */
	{0x4000c02b, 0x00000002}, /* ADC_DITHER_LEV */
	{0x4000c030, 0x00000010}, /* PGA0_CTRL1 */
	{0x4000c031, 0x00000003}, /* PGA0_CTRL2 */
	{0x4000c032, 0x00000010}, /* PGA1_CTRL1 */
	{0x4000c033, 0x00000003}, /* PGA1_CTRL2 */
	{0x4000c034, 0x00000000}, /* PGA2_CTRL1 */
	{0x4000c035, 0x00000000}, /* PGA2_CTRL2 */
	{0x4000c036, 0x00000000}, /* PGA_CTRL1 */
	{0x4000c037, 0x00000000}, /* PGA_CTRL2 */
	{0x4000c040, 0x00000022}, /* DMIC_CTRL1 */
	{0x4000c041, 0x0000000C}, /* DMIC_CTRL2 */
	{0x4000c042, 0x0000000C}, /* DMIC_CTRL3 */
	{0x4000c043, 0x00000004}, /* DMIC_CTRL4 */
	{0x4000c044, 0x00000000}, /* DMIC_MUTES */
	{0x4000c045, 0x00000040}, /* DMIC_VOL0 */
	{0x4000c046, 0x00000040}, /* DMIC_VOL1 */
	{0x4000c047, 0x00000040}, /* DMIC_VOL2 */
	{0x4000c048, 0x00000040}, /* DMIC_VOL3 */
	{0x4000c049, 0x00000024}, /* DMIC_CTRL5 */
	{0x4000c04a, 0x00000024}, /* DMIC_CTRL6 */
	{0x4000c04b, 0x00000017}, /* DMIC_CTRL7 */
	{0x4000c04c, 0x00000040}, /* DMIC_VOL4 */
	{0x4000c04d, 0x00000040}, /* DMIC_VOL5 */
	{0x4000c04e, 0x00000040}, /* DMIC_VOL6 */
	{0x4000c04f, 0x00000040}, /* DMIC_VOL7 */
	{0x4000c050, 0x00000002}, /* DAC_CTRL1 */
	{0x4000c053, 0x00000044}, /* DAC_ROUTE0 */
	{0x4000c060, 0x00000000}, /* HP_CTRL */
	{0x4000c061, 0x00000000}, /* HP_LVMODE_CTRL1 */
	{0x4000c062, 0x00000030}, /* HP_LVMODE_CTRL2 */
	{0x4000c063, 0x00000000}, /* HP_LVMODE_CTRL3 */
	{0x4000c066, 0x00000000}, /* HPLDO_CTRL */
	{0x4000c06c, 0x00000000}, /* PB_CTRL */
	{0x4000c070, 0x00000000}, /* PMU_CTRL1 */
	{0x4000c071, 0x00000000}, /* PMU_CTRL2 */
	{0x4000c072, 0x00000000}, /* PMU_CTRL3 */
	{0x4000c073, 0x00000000}, /* PMU_CTRL4 */
	{0x4000c074, 0x00000081}, /* PMU_CTRL5 */
	{0x4000c080, 0x00000024}, /* FDEC_CTRL1 */
	{0x4000c081, 0x00000025}, /* FDEC_CTRL2 */
	{0x4000c082, 0x00000025}, /* FDEC_CTRL3 */
	{0x4000c083, 0x00000025}, /* FDEC_CTRL4 */
	{0x4000c084, 0x00000002}, /* FDEC_ROUTE0 */
	{0x4000c085, 0x00000000}, /* FDEC_ROUTE1 */
	{0x4000c086, 0x00000000}, /* FDEC_ROUTE2 */
	{0x4000c087, 0x00000000}, /* FDEC_ROUTE3 */
	{0x4000c088, 0x00000000}, /* FDEC_ROUTE4 */
	{0x4000c089, 0x00000000}, /* FDEC_ROUTE5 */
	{0x4000c08a, 0x00000000}, /* FDEC_ROUTE6 */
	{0x4000c08b, 0x00000000}, /* FDEC_ROUTE7 */
	{0x4000c090, 0x00000042}, /* FINT_CTRL1 */
	{0x4000c091, 0x00000042}, /* FINT_CTRL2 */
	{0x4000c092, 0x00000042}, /* FINT_CTRL3 */
	{0x4000c093, 0x00000042}, /* FINT_CTRL4 */
	{0x4000c094, 0x00000000}, /* FINT_ROUTE0 */
	{0x4000c095, 0x00000001}, /* FINT_ROUTE1 */
	{0x4000c096, 0x00000010}, /* FINT_ROUTE2 */
	{0x4000c097, 0x00000011}, /* FINT_ROUTE3 */
	{0x4000c098, 0x00000000}, /* FINT_ROUTE4 */
	{0x4000c099, 0x00000000}, /* FINT_ROUTE5 */
	{0x4000c09a, 0x00000000}, /* FINT_ROUTE6 */
	{0x4000c09b, 0x00000000}, /* FINT_ROUTE7 */
	{0x4000c0a0, 0x00000014}, /* ASRCI_CTRL */
	{0x4000c0a1, 0x00000010}, /* ASRCI_ROUTE01 */
	{0x4000c0a2, 0x00000000}, /* ASRCI_ROUTE23 */
	{0x4000c0a3, 0x00000014}, /* ASRCO_CTRL */
	{0x4000c0a4, 0x00000002}, /* ASRCO_ROUTE0 */
	{0x4000c0a5, 0x00000000}, /* ASRCO_ROUTE1 */
	{0x4000c0a6, 0x00000000}, /* ASRCO_ROUTE2 */
	{0x4000c0a7, 0x00000000}, /* ASRCO_ROUTE3 */
	{0x4000c0b0, 0x00000000}, /* FDSP_RUN */
	{0x4000c0b1, 0x00000070}, /* FDSP_CTRL1 */
	{0x4000c0b2, 0x0000003F}, /* FDSP_CTRL2 */
	{0x4000c0b3, 0x00000000}, /* FDSP_CTRL3 */
	{0x4000c0b4, 0x00000002}, /* FDSP_CTRL4 */
	{0x4000c0b5, 0x0000007F}, /* FDSP_CTRL5 */
	{0x4000c0b6, 0x00000000}, /* FDSP_CTRL6 */
	{0x4000c0b7, 0x00000000}, /* FDSP_CTRL7 */
	{0x4000c0b8, 0x00000000}, /* FDSP_CTRL8 */
	{0x4000c0b9, 0x00000000}, /* FDSP_SL_ADDR */
	{0x4000c0ba, 0x00000000}, /* FDSP_SL_P0_0 */
	{0x4000c0bb, 0x00000000}, /* FDSP_SL_P0_1 */
	{0x4000c0bc, 0x00000000}, /* FDSP_SL_P0_2 */
	{0x4000c0bd, 0x00000000}, /* FDSP_SL_P0_3 */
	{0x4000c0be, 0x00000000}, /* FDSP_SL_P1_0 */
	{0x4000c0bf, 0x00000000}, /* FDSP_SL_P1_1 */
	{0x4000c0c0, 0x00000000}, /* FDSP_SL_P1_2 */
	{0x4000c0c1, 0x00000000}, /* FDSP_SL_P1_3 */
	{0x4000c0c2, 0x00000000}, /* FDSP_SL_P2_0 */
	{0x4000c0c3, 0x00000000}, /* FDSP_SL_P2_1 */
	{0x4000c0c4, 0x00000000}, /* FDSP_SL_P2_2 */
	{0x4000c0c5, 0x00000000}, /* FDSP_SL_P2_3 */
	{0x4000c0c6, 0x00000000}, /* FDSP_SL_P3_0 */
	{0x4000c0c7, 0x00000000}, /* FDSP_SL_P3_1 */
	{0x4000c0c8, 0x00000000}, /* FDSP_SL_P3_2 */
	{0x4000c0c9, 0x00000000}, /* FDSP_SL_P3_3 */
	{0x4000c0ca, 0x00000000}, /* FDSP_SL_P4_0 */
	{0x4000c0cb, 0x00000000}, /* FDSP_SL_P4_1 */
	{0x4000c0cc, 0x00000000}, /* FDSP_SL_P4_2 */
	{0x4000c0cd, 0x00000000}, /* FDSP_SL_P4_3 */
	{0x4000c0cf, 0x00000000}, /* FDSP_ONZ_MASK0 */
	{0x4000c0d0, 0x00000000}, /* FDSP_ONZ_MASK1 */
	{0x4000c0d1, 0x00000000}, /* FDSP_ONZ_MASK2 */
	{0x4000c0d2, 0x00000000}, /* EQ_CFG */
	{0x4000c0d3, 0x00000000}, /* EQ_ROUTE */
	{0x4000c0d5, 0x00000000}, /* TDSP_ALTVEC_EN */
	{0x4000c0d8, 0x00000000}, /* TDSP_ALTVEC_ADDR0 */
	{0x4000c0d9, 0x00000000}, /* TDSP_ALTVEC_ADDR1 */
	{0x4000c0da, 0x00000000}, /* TDSP_ALTVEC_ADDR2 */
	{0x4000c0db, 0x00000000}, /* TDSP_ALTVEC_ADDR3 */
	{0x4000c0dc, 0x00000001}, /* TDSP_RUN */
	{0x4000c0dd, 0x00000004}, /* TDSP_GPI */
	{0x4000c0e0, 0x00000000}, /* SPT0_CTRL1 */
	{0x4000c0e1, 0x00000001}, /* SPT0_CTRL2 */
	{0x4000c0e2, 0x00000001}, /* SPT0_CTRL3 */
	{0x4000c0e3, 0x0000002B}, /* SPT0_ROUTE0 */
	{0x4000c0e4, 0x0000003F}, /* SPT0_ROUTE1 */
	{0x4000c0e5, 0x0000003F}, /* SPT0_ROUTE2 */
	{0x4000c0e6, 0x0000003F}, /* SPT0_ROUTE3 */
	{0x4000c0e7, 0x0000003F}, /* SPT0_ROUTE4 */
	{0x4000c0e8, 0x0000003F}, /* SPT0_ROUTE5 */
	{0x4000c0e9, 0x0000003F}, /* SPT0_ROUTE6 */
	{0x4000c0ea, 0x0000003F}, /* SPT0_ROUTE7 */
	{0x4000c0eb, 0x0000003F}, /* SPT0_ROUTE8 */
	{0x4000c0ec, 0x0000003F}, /* SPT0_ROUTE9 */
	{0x4000c0ed, 0x0000003F}, /* SPT0_ROUTE10 */
	{0x4000c0ee, 0x0000003F}, /* SPT0_ROUTE11 */
	{0x4000c0ef, 0x0000003F}, /* SPT0_ROUTE12 */
	{0x4000c0f0, 0x0000003F}, /* SPT0_ROUTE13 */
	{0x4000c0f1, 0x0000003F}, /* SPT0_ROUTE14 */
	{0x4000c0f2, 0x0000003F}, /* SPT0_ROUTE15 */
	{0x4000c0f3, 0x00000000}, /* SPT1_CTRL1 */
	{0x4000c0f4, 0x00000000}, /* SPT1_CTRL2 */
	{0x4000c0f5, 0x00000000}, /* SPT1_CTRL3 */
	{0x4000c0f6, 0x00000020}, /* SPT1_ROUTE0 */
	{0x4000c0f7, 0x0000003F}, /* SPT1_ROUTE1 */
	{0x4000c0f8, 0x0000003F}, /* SPT1_ROUTE2 */
	{0x4000c0f9, 0x0000003F}, /* SPT1_ROUTE3 */
	{0x4000c0fa, 0x0000003F}, /* SPT1_ROUTE4 */
	{0x4000c0fb, 0x0000003F}, /* SPT1_ROUTE5 */
	{0x4000c0fc, 0x0000003F}, /* SPT1_ROUTE6 */
	{0x4000c0fd, 0x0000003F}, /* SPT1_ROUTE7 */
	{0x4000c0fe, 0x0000003F}, /* SPT1_ROUTE8 */
	{0x4000c0ff, 0x0000003F}, /* SPT1_ROUTE9 */
	{0x4000c100, 0x0000003F}, /* SPT1_ROUTE10 */
	{0x4000c101, 0x0000003F}, /* SPT1_ROUTE11 */
	{0x4000c102, 0x0000003F}, /* SPT1_ROUTE12 */
	{0x4000c103, 0x0000003F}, /* SPT1_ROUTE13 */
	{0x4000c104, 0x0000003F}, /* SPT1_ROUTE14 */
	{0x4000c105, 0x0000003F}, /* SPT1_ROUTE15 */
	{0x4000c118, 0x00000004}, /* PDM_CTRL1 */
	{0x4000c119, 0x00000004}, /* PDM_CTRL2 */
	{0x4000c11a, 0x00000066}, /* PDM_VOL0 */
	{0x4000c11b, 0x00000066}, /* PDM_VOL1 */
	{0x4000c11c, 0x00000020}, /* PDM_ROUTE0 */
	{0x4000c11d, 0x00000021}, /* PDM_ROUTE1 */
	{0x4000c121, 0x00000000}, /* MP_CTRL1 */
	{0x4000c122, 0x00000000}, /* MP_CTRL2 */
	{0x4000c123, 0x00000000}, /* MP_CTRL3 */
	{0x4000c124, 0x00000000}, /* MP_CTRL4 */
	{0x4000c125, 0x00000000}, /* MP_CTRL5 */
	{0x4000c126, 0x000000E0}, /* MP_CTRL6 */
	{0x4000c127, 0x000000AC}, /* MP_CTRL7 */
	{0x4000c128, 0x0000000B}, /* MP_CTRL8 */
	{0x4000c129, 0x00000000}, /* MP_CTRL9 */
	{0x4000c12a, 0x00000000}, /* MP_CTRL10 */
	{0x4000c12b, 0x00000000}, /* MP_CTRL11 */
	{0x4000c12c, 0x00000000}, /* MP_CTRL12 */
	{0x4000c12d, 0x00000000}, /* MP_CTRL13 */
	{0x4000c12e, 0x00000000}, /* MP_DB_CTRL */
	{0x4000c12f, 0x00000001}, /* MP_MCLKO_RATE */
	{0x4000c130, 0x00000000}, /* MP_GPIO_CTRL1 */
	{0x4000c131, 0x00000000}, /* MP_GPIO_CTRL2 */
	{0x4000c132, 0x00000000}, /* MP_GPIO_CTRL3 */
	{0x4000c133, 0x00000000}, /* MP_GPIO_CTRL4 */
	{0x4000c134, 0x00000005}, /* DMIC_CLK_CTRL */
	{0x4000c135, 0x00000005}, /* DMIC01_CTRL */
	{0x4000c136, 0x00000005}, /* DMIC23_CTRL */
	{0x4000c137, 0x00000005}, /* BCLK0_CTRL */
	{0x4000c138, 0x00000005}, /* FSYNC0_CTRL */
	{0x4000c139, 0x00000005}, /* SDATAO0_CTRL */
	{0x4000c13a, 0x00000005}, /* SDATAI0_CTRL */
	{0x4000c13b, 0x00000005}, /* BCLK1_CTRL */
	{0x4000c13c, 0x00000005}, /* FSYNC1_CTRL */
	{0x4000c13d, 0x00000005}, /* SDATAO1_CTRL */
	{0x4000c13e, 0x00000005}, /* SDATAI1_CTRL */
	{0x4000c13f, 0x00000005}, /* QSPIM_CLK_CTRL */
	{0x4000c140, 0x00000005}, /* QSPIM_CS_CTRL */
	{0x4000c141, 0x00000005}, /* QSPIM_SDIO0_CTRL */
	{0x4000c142, 0x00000005}, /* QSPIM_SDIO1_CTRL */
	{0x4000c143, 0x00000005}, /* QSPIM_SDIO2_CTRL */
	{0x4000c144, 0x00000025}, /* QSPIM_SDIO3_CTRL */
	{0x4000c145, 0x00000025}, /* UART_COMM_TX_CTRL */
	{0x4000c146, 0x00000025}, /* UART_COMM_RX_CTRL */
	{0x4000c147, 0x00000005}, /* SELFBOOT_CTRL */
	{0x4000c148, 0x00000005}, /* IRQ_CTRL */
	{0x4000c149, 0x00000005}, /* ROM_BOOT_MODE_CTRL */
	{0x4000c14a, 0x00000015}, /* TCK_CTRL */
	{0x4000c14b, 0x00000035}, /* TMS_CTRL */
	{0x4000c14c, 0x00000005}, /* TDO_CTRL */
	{0x4000c14d, 0x00000035}, /* TDI_CTRL */
	{0x4000c14e, 0x00000000}, /* I2C_SPI_CTRL */
	{0x4000c150, 0x00000000}, /* IRQ_CTRL1 */
	{0x4000c151, 0x0000007F}, /* IRQ1_MASK1 */
	{0x4000c152, 0x000000F7}, /* IRQ1_MASK2 */
	{0x4000c153, 0x0000003F}, /* IRQ1_MASK3 */
	{0x4000c154, 0x0000003F}, /* IRQ1_MASK4 */
	{0x4000c155, 0x0000000F}, /* IRQ1_MASK5 */
	{0x4000c156, 0x0000007F}, /* IRQ2_MASK1 */
	{0x4000c157, 0x000000F7}, /* IRQ2_MASK2 */
	{0x4000c158, 0x0000003F}, /* IRQ2_MASK3 */
	{0x4000c159, 0x0000003F}, /* IRQ2_MASK4 */
	{0x4000c15a, 0x0000000F}, /* IRQ2_MASK5 */
	{0x4000c15b, 0x0000007F}, /* IRQ3_MASK1 */
	{0x4000c15c, 0x000000F7}, /* IRQ3_MASK2 */
	{0x4000c15d, 0x0000003F}, /* IRQ3_MASK3 */
	{0x4000c15e, 0x0000003F}, /* IRQ3_MASK4 */
	{0x4000c15f, 0x0000000F}, /* IRQ3_MASK5 */
	{0x4000c160, 0x0000007F}, /* IRQ4_MASK1 */
	{0x4000c161, 0x000000F7}, /* IRQ4_MASK2 */
	{0x4000c162, 0x0000003F}, /* IRQ4_MASK3 */
	{0x4000c163, 0x0000003F}, /* IRQ4_MASK4 */
	{0x4000c164, 0x0000000F}, /* IRQ4_MASK5 */
	{0x4000c165, 0x00000000}, /* SW_INT */
	{0x4000c169, 0x00000000}, /* MP_INPUT_IRQ_CTRL2 */
	{0x4000c16a, 0x000000FF}, /* MP_INPUT_IRQ1_MASK1 */
	{0x4000c16b, 0x000000FF}, /* MP_INPUT_IRQ1_MASK2 */
	{0x4000c16c, 0x000000FF}, /* MP_INPUT_IRQ1_MASK3 */
	{0x4000c16d, 0x00000003}, /* MP_INPUT_IRQ1_MASK4 */
	{0x4000c16e, 0x000000FF}, /* MP_INPUT_IRQ2_MASK1 */
	{0x4000c16f, 0x000000FF}, /* MP_INPUT_IRQ2_MASK2 */
	{0x4000c170, 0x000000FF}, /* MP_INPUT_IRQ2_MASK3 */
	{0x4000c171, 0x00000003}, /* MP_INPUT_IRQ2_MASK4 */
	{0x4000c172, 0x000000FF}, /* MP_INPUT_IRQ3_MASK1 */
	{0x4000c173, 0x000000FF}, /* MP_INPUT_IRQ3_MASK2 */
	{0x4000c174, 0x000000FF}, /* MP_INPUT_IRQ3_MASK3 */
	{0x4000c175, 0x00000003}, /* MP_INPUT_IRQ3_MASK4 */
	{0x4000c1d0, 0x00000001}, /* FDSP_MODE */
	{0x4000cc04, 0x00000000}, /* DAC_NOISE_CTRL2 */
	{0x4000cc12, 0x00000000}, /* DAC_NOISE_CTRL1 */
};

// post-memory registers
uint32_t reg_post[5][2] =
{
    /* post-memory registers */
    {0x4000c008, 0x00000001}, /* DSP_PWR */
	{0x4000c00e, 0x00000007}, /* CHIP_PWR */
	{0x4000c004, 0x00000001}, /* ADC_DAC_HP_PWR */
	{0x4000c051, 0x00000004}, /* DAC_CTRL2 */
	{0x4000c052, 0x00000081}, /* DAC_VOL0 */
};

// dsp_programme_es20_mic_test_1_fdsp

uint32_t fdsp_program[17] =
{
    0x01805000, 0x01805200, 0x01805400, 0x01805600, 0x01805800, 0x01805A00, 0x01C05C00, 0x01805E00, 0x01C06000, 0x01C04800, 0x04800400, 0x01C04800, 0x04800000, 0x01C04800, 0x04800200, 0x00000000, 0x00000000
};

uint32_t fdsp_param_bank_a[5][17] =
{
    {0x09F00000, 0x0BF00000, 0x0DF00000, 0x0FF00000, 0x11F00000, 0x13F00000, 0xD5AF66D0, 0x01F00000, 0xDFA34800, 0xE1B80000, 0xC8000000, 0x80300000, 0xC8000000, 0x82340000, 0xC8000000, 0x00000000, 0x00000000},
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x08000000, 0x00014700, 0x08000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000},
    {0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000}
};

uint32_t fdsp_param_bank_b[5][17] =
{
    {0x09F00000, 0x0BF00000, 0x0DF00000, 0x0FF00000, 0x11F00000, 0x13F00000, 0xD5AF66D0, 0x01F00000, 0xDFA34800, 0xE1B80000, 0xC8000000, 0x80300000, 0xC8000000, 0x82340000, 0xC8000000, 0x00000000, 0x00000000},
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x08000000, 0x00014700, 0x08000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000},
    {0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000}
};

uint32_t fdsp_param_bank_c[5][17] =
{
    {0x09F00000, 0x0BF00000, 0x0DF00000, 0x0FF00000, 0x11F00000, 0x13F00000, 0xD5AF66D0, 0x01F00000, 0xDFA34800, 0xE1B80000, 0xC8000000, 0x80300000, 0xC8000000, 0x82340000, 0xC8000000, 0x00000000, 0x00000000},
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x00014700, 0x08000000, 0x00014700, 0x08000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000},
    {0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000}
};
        

// .............................................................................
#else
// .............................................................................

// dsp_programme_es20_master_slave_v7_RBS_27nov24_MOD_Dec6_regs

// pre-memory registers
uint32_t reg_pre[283][2] =
{
    {0x4000c051, 0x00000044}, /* DAC_CTRL2 */
	{0x4000c052, 0x000000FD}, /* DAC_VOL0 */
	{0x4000c004, 0x00000000}, /* ADC_DAC_HP_PWR */
	{0x4000c01c, 0x00000093}, /* CLK_CTRL13 */
	{0x4000c005, 0x00000002}, /* PLL_PGA_PWR */
	{0x4000c00e, 0x00000003}, /* CHIP_PWR */
	{0x4000c00e, 0x00000013}, /* CHIP_PWR */
	{0x4000c005, 0x00000003}, /* PLL_PGA_PWR */
	{0x4000c010, 0x000000C8}, /* CLK_CTRL1 */
	{0x4000c011, 0x00000000}, /* CLK_CTRL2 */
	{0x4000c012, 0x00000004}, /* CLK_CTRL3 */
	{0x4000c013, 0x00000000}, /* CLK_CTRL4 */
	{0x4000c014, 0x00000000}, /* CLK_CTRL5 */
	{0x4000c015, 0x00000000}, /* CLK_CTRL6 */
	{0x4000c016, 0x00000000}, /* CLK_CTRL7 */
	{0x4000c017, 0x00000000}, /* CLK_CTRL8 */
	{0x4000c019, 0x000000C0}, /* CLK_CTRL10 */
	{0x4000c01a, 0x00000000}, /* CLK_CTRL11 */
	{0x4000c01b, 0x00000000}, /* CLK_CTRL12 */
	{0x4000c01c, 0x00000013}, /* CLK_CTRL13 */
	{0x4000c01d, 0x000000FF}, /* CLK_CTRL14 */
	{0x4000c01e, 0x000000FF}, /* CLK_CTRL15 */
	{0x4000c018, 0x00000001}, /* CLK_CTRL9 */
	{0x4000c018, 0x00000001}, /* CLK_CTRL9 */
	{0x4000c008, 0x00000001}, /* DSP_PWR */
	{0x4000c006, 0x0000003F}, /* DMIC_PWR */
	{0x4000c007, 0x000000FF}, /* SAI_CLK_PWR */
	{0x4000c009, 0x000000FF}, /* ASRC_PWR */
	{0x4000c00a, 0x0000000F}, /* FINT_PWR */
	{0x4000c00b, 0x0000000F}, /* FDEC_PWR */
	{0x4000c00c, 0x00000001}, /* KEEP_CM */
	{0x4000c00d, 0x00000000}, /* MEM_RETAIN */
	{0x4000c020, 0x00000022}, /* ADC_CTRL1 */
	{0x4000c021, 0x00000000}, /* ADC_CTRL2 */
	{0x4000c022, 0x00000000}, /* ADC_CTRL3 */
	{0x4000c023, 0x00000000}, /* ADC_CTRL4 */
	{0x4000c024, 0x00000040}, /* ADC_CTRL5 */
	{0x4000c025, 0x00000086}, /* ADC_CTRL6 */
	{0x4000c026, 0x00000000}, /* ADC_CTRL7 */
	{0x4000c027, 0x00000000}, /* ADC_MUTES */
	{0x4000c028, 0x00000040}, /* ADC0_VOL */
	{0x4000c029, 0x00000040}, /* ADC1_VOL */
	{0x4000c02a, 0x000000A3}, /* ADC2_VOL */
	{0x4000c02b, 0x00000002}, /* ADC_DITHER_LEV */
	{0x4000c030, 0x00000010}, /* PGA0_CTRL1 */
	{0x4000c031, 0x00000003}, /* PGA0_CTRL2 */
	{0x4000c032, 0x00000010}, /* PGA1_CTRL1 */
	{0x4000c033, 0x00000003}, /* PGA1_CTRL2 */
	{0x4000c034, 0x00000000}, /* PGA2_CTRL1 */
	{0x4000c035, 0x00000000}, /* PGA2_CTRL2 */
	{0x4000c036, 0x00000000}, /* PGA_CTRL1 */
	{0x4000c037, 0x00000000}, /* PGA_CTRL2 */
	{0x4000c040, 0x00000022}, /* DMIC_CTRL1 */
	{0x4000c041, 0x0000000C}, /* DMIC_CTRL2 */
	{0x4000c042, 0x0000000C}, /* DMIC_CTRL3 */
	{0x4000c043, 0x00000004}, /* DMIC_CTRL4 */
	{0x4000c044, 0x00000000}, /* DMIC_MUTES */
	{0x4000c045, 0x00000040}, /* DMIC_VOL0 */
	{0x4000c046, 0x00000040}, /* DMIC_VOL1 */
	{0x4000c047, 0x00000040}, /* DMIC_VOL2 */
	{0x4000c048, 0x00000040}, /* DMIC_VOL3 */
	{0x4000c049, 0x00000024}, /* DMIC_CTRL5 */
	{0x4000c04a, 0x00000024}, /* DMIC_CTRL6 */
	{0x4000c04b, 0x00000017}, /* DMIC_CTRL7 */
	{0x4000c04c, 0x00000040}, /* DMIC_VOL4 */
	{0x4000c04d, 0x00000040}, /* DMIC_VOL5 */
	{0x4000c04e, 0x00000040}, /* DMIC_VOL6 */
	{0x4000c04f, 0x00000040}, /* DMIC_VOL7 */
	{0x4000c050, 0x00000002}, /* DAC_CTRL1 */
	{0x4000c053, 0x00000044}, /* DAC_ROUTE0 */
	{0x4000c060, 0x00000000}, /* HP_CTRL */
	{0x4000c061, 0x00000000}, /* HP_LVMODE_CTRL1 */
	{0x4000c062, 0x00000030}, /* HP_LVMODE_CTRL2 */
	{0x4000c063, 0x00000000}, /* HP_LVMODE_CTRL3 */
	{0x4000c066, 0x00000000}, /* HPLDO_CTRL */
	{0x4000c06c, 0x00000000}, /* PB_CTRL */
	{0x4000c070, 0x00000000}, /* PMU_CTRL1 */
	{0x4000c071, 0x00000000}, /* PMU_CTRL2 */
	{0x4000c072, 0x00000000}, /* PMU_CTRL3 */
	{0x4000c073, 0x00000000}, /* PMU_CTRL4 */
	{0x4000c074, 0x00000081}, /* PMU_CTRL5 */
	{0x4000c080, 0x00000024}, /* FDEC_CTRL1 */
	{0x4000c081, 0x00000025}, /* FDEC_CTRL2 */
	{0x4000c082, 0x00000025}, /* FDEC_CTRL3 */
	{0x4000c083, 0x00000025}, /* FDEC_CTRL4 */
	{0x4000c084, 0x00000002}, /* FDEC_ROUTE0 */
	{0x4000c085, 0x00000000}, /* FDEC_ROUTE1 */
	{0x4000c086, 0x00000000}, /* FDEC_ROUTE2 */
	{0x4000c087, 0x00000000}, /* FDEC_ROUTE3 */
	{0x4000c088, 0x00000000}, /* FDEC_ROUTE4 */
	{0x4000c089, 0x00000000}, /* FDEC_ROUTE5 */
	{0x4000c08a, 0x00000000}, /* FDEC_ROUTE6 */
	{0x4000c08b, 0x00000000}, /* FDEC_ROUTE7 */
	{0x4000c090, 0x00000042}, /* FINT_CTRL1 */
	{0x4000c091, 0x00000042}, /* FINT_CTRL2 */
	{0x4000c092, 0x00000042}, /* FINT_CTRL3 */
	{0x4000c093, 0x00000042}, /* FINT_CTRL4 */
	{0x4000c094, 0x00000000}, /* FINT_ROUTE0 */
	{0x4000c095, 0x00000001}, /* FINT_ROUTE1 */
	{0x4000c096, 0x00000010}, /* FINT_ROUTE2 */
	{0x4000c097, 0x00000011}, /* FINT_ROUTE3 */
	{0x4000c098, 0x00000000}, /* FINT_ROUTE4 */
	{0x4000c099, 0x00000000}, /* FINT_ROUTE5 */
	{0x4000c09a, 0x00000000}, /* FINT_ROUTE6 */
	{0x4000c09b, 0x00000000}, /* FINT_ROUTE7 */
	{0x4000c0a0, 0x00000014}, /* ASRCI_CTRL */
	{0x4000c0a1, 0x00000010}, /* ASRCI_ROUTE01 */
	{0x4000c0a2, 0x00000000}, /* ASRCI_ROUTE23 */
	{0x4000c0a3, 0x00000014}, /* ASRCO_CTRL */
	{0x4000c0a4, 0x00000002}, /* ASRCO_ROUTE0 */
	{0x4000c0a5, 0x00000000}, /* ASRCO_ROUTE1 */
	{0x4000c0a6, 0x00000000}, /* ASRCO_ROUTE2 */
	{0x4000c0a7, 0x00000000}, /* ASRCO_ROUTE3 */
	{0x4000c0b0, 0x00000000}, /* FDSP_RUN */
	{0x4000c0b1, 0x00000070}, /* FDSP_CTRL1 */
	{0x4000c0b2, 0x0000003F}, /* FDSP_CTRL2 */
	{0x4000c0b3, 0x00000000}, /* FDSP_CTRL3 */
	{0x4000c0b4, 0x00000002}, /* FDSP_CTRL4 */
	{0x4000c0b5, 0x0000007F}, /* FDSP_CTRL5 */
	{0x4000c0b6, 0x00000000}, /* FDSP_CTRL6 */
	{0x4000c0b7, 0x00000000}, /* FDSP_CTRL7 */
	{0x4000c0b8, 0x00000000}, /* FDSP_CTRL8 */
	{0x4000c0b9, 0x00000000}, /* FDSP_SL_ADDR */
	{0x4000c0ba, 0x00000000}, /* FDSP_SL_P0_0 */
	{0x4000c0bb, 0x00000000}, /* FDSP_SL_P0_1 */
	{0x4000c0bc, 0x00000000}, /* FDSP_SL_P0_2 */
	{0x4000c0bd, 0x00000000}, /* FDSP_SL_P0_3 */
	{0x4000c0be, 0x00000000}, /* FDSP_SL_P1_0 */
	{0x4000c0bf, 0x00000000}, /* FDSP_SL_P1_1 */
	{0x4000c0c0, 0x00000000}, /* FDSP_SL_P1_2 */
	{0x4000c0c1, 0x00000000}, /* FDSP_SL_P1_3 */
	{0x4000c0c2, 0x00000000}, /* FDSP_SL_P2_0 */
	{0x4000c0c3, 0x00000000}, /* FDSP_SL_P2_1 */
	{0x4000c0c4, 0x00000000}, /* FDSP_SL_P2_2 */
	{0x4000c0c5, 0x00000000}, /* FDSP_SL_P2_3 */
	{0x4000c0c6, 0x00000000}, /* FDSP_SL_P3_0 */
	{0x4000c0c7, 0x00000000}, /* FDSP_SL_P3_1 */
	{0x4000c0c8, 0x00000000}, /* FDSP_SL_P3_2 */
	{0x4000c0c9, 0x00000000}, /* FDSP_SL_P3_3 */
	{0x4000c0ca, 0x00000000}, /* FDSP_SL_P4_0 */
	{0x4000c0cb, 0x00000000}, /* FDSP_SL_P4_1 */
	{0x4000c0cc, 0x00000000}, /* FDSP_SL_P4_2 */
	{0x4000c0cd, 0x00000000}, /* FDSP_SL_P4_3 */
	{0x4000c0cf, 0x00000000}, /* FDSP_ONZ_MASK0 */
	{0x4000c0d0, 0x00000000}, /* FDSP_ONZ_MASK1 */
	{0x4000c0d1, 0x00000000}, /* FDSP_ONZ_MASK2 */
	{0x4000c0d2, 0x00000000}, /* EQ_CFG */
	{0x4000c0d3, 0x00000000}, /* EQ_ROUTE */
	{0x4000c0d5, 0x00000000}, /* TDSP_ALTVEC_EN */
	{0x4000c0d8, 0x00000000}, /* TDSP_ALTVEC_ADDR0 */
	{0x4000c0d9, 0x00000000}, /* TDSP_ALTVEC_ADDR1 */
	{0x4000c0da, 0x00000000}, /* TDSP_ALTVEC_ADDR2 */
	{0x4000c0db, 0x00000000}, /* TDSP_ALTVEC_ADDR3 */
	{0x4000c0dc, 0x00000001}, /* TDSP_RUN */
	{0x4000c0dd, 0x00000004}, /* TDSP_GPI */
	{0x4000c0e0, 0x00000000}, /* SPT0_CTRL1 */
	{0x4000c0e1, 0x00000001}, /* SPT0_CTRL2 */
	{0x4000c0e2, 0x00000001}, /* SPT0_CTRL3 */
	{0x4000c0e3, 0x0000002B}, /* SPT0_ROUTE0 */
	{0x4000c0e4, 0x0000003F}, /* SPT0_ROUTE1 */
	{0x4000c0e5, 0x0000003F}, /* SPT0_ROUTE2 */
	{0x4000c0e6, 0x0000003F}, /* SPT0_ROUTE3 */
	{0x4000c0e7, 0x0000003F}, /* SPT0_ROUTE4 */
	{0x4000c0e8, 0x0000003F}, /* SPT0_ROUTE5 */
	{0x4000c0e9, 0x0000003F}, /* SPT0_ROUTE6 */
	{0x4000c0ea, 0x0000003F}, /* SPT0_ROUTE7 */
	{0x4000c0eb, 0x0000003F}, /* SPT0_ROUTE8 */
	{0x4000c0ec, 0x0000003F}, /* SPT0_ROUTE9 */
	{0x4000c0ed, 0x0000003F}, /* SPT0_ROUTE10 */
	{0x4000c0ee, 0x0000003F}, /* SPT0_ROUTE11 */
	{0x4000c0ef, 0x0000003F}, /* SPT0_ROUTE12 */
	{0x4000c0f0, 0x0000003F}, /* SPT0_ROUTE13 */
	{0x4000c0f1, 0x0000003F}, /* SPT0_ROUTE14 */
	{0x4000c0f2, 0x0000003F}, /* SPT0_ROUTE15 */
	{0x4000c0f3, 0x00000000}, /* SPT1_CTRL1 */
	{0x4000c0f4, 0x00000000}, /* SPT1_CTRL2 */
	{0x4000c0f5, 0x00000000}, /* SPT1_CTRL3 */
	{0x4000c0f6, 0x00000020}, /* SPT1_ROUTE0 */
	{0x4000c0f7, 0x0000003F}, /* SPT1_ROUTE1 */
	{0x4000c0f8, 0x0000003F}, /* SPT1_ROUTE2 */
	{0x4000c0f9, 0x0000003F}, /* SPT1_ROUTE3 */
	{0x4000c0fa, 0x0000003F}, /* SPT1_ROUTE4 */
	{0x4000c0fb, 0x0000003F}, /* SPT1_ROUTE5 */
	{0x4000c0fc, 0x0000003F}, /* SPT1_ROUTE6 */
	{0x4000c0fd, 0x0000003F}, /* SPT1_ROUTE7 */
	{0x4000c0fe, 0x0000003F}, /* SPT1_ROUTE8 */
	{0x4000c0ff, 0x0000003F}, /* SPT1_ROUTE9 */
	{0x4000c100, 0x0000003F}, /* SPT1_ROUTE10 */
	{0x4000c101, 0x0000003F}, /* SPT1_ROUTE11 */
	{0x4000c102, 0x0000003F}, /* SPT1_ROUTE12 */
	{0x4000c103, 0x0000003F}, /* SPT1_ROUTE13 */
	{0x4000c104, 0x0000003F}, /* SPT1_ROUTE14 */
	{0x4000c105, 0x0000003F}, /* SPT1_ROUTE15 */
	{0x4000c118, 0x00000004}, /* PDM_CTRL1 */
	{0x4000c119, 0x00000004}, /* PDM_CTRL2 */
	{0x4000c11a, 0x00000066}, /* PDM_VOL0 */
	{0x4000c11b, 0x00000066}, /* PDM_VOL1 */
	{0x4000c11c, 0x00000020}, /* PDM_ROUTE0 */
	{0x4000c11d, 0x00000021}, /* PDM_ROUTE1 */
	{0x4000c121, 0x00000000}, /* MP_CTRL1 */
	{0x4000c122, 0x00000000}, /* MP_CTRL2 */
	{0x4000c123, 0x00000000}, /* MP_CTRL3 */
	{0x4000c124, 0x00000000}, /* MP_CTRL4 */
	{0x4000c125, 0x00000000}, /* MP_CTRL5 */
	{0x4000c126, 0x000000E0}, /* MP_CTRL6 */
	{0x4000c127, 0x000000AC}, /* MP_CTRL7 */
	{0x4000c128, 0x0000000B}, /* MP_CTRL8 */
	{0x4000c129, 0x00000000}, /* MP_CTRL9 */
	{0x4000c12a, 0x00000000}, /* MP_CTRL10 */
	{0x4000c12b, 0x00000000}, /* MP_CTRL11 */
	{0x4000c12c, 0x00000000}, /* MP_CTRL12 */
	{0x4000c12d, 0x00000000}, /* MP_CTRL13 */
	{0x4000c12e, 0x00000000}, /* MP_DB_CTRL */
	{0x4000c12f, 0x00000001}, /* MP_MCLKO_RATE */
	{0x4000c130, 0x00000000}, /* MP_GPIO_CTRL1 */
	{0x4000c131, 0x00000000}, /* MP_GPIO_CTRL2 */
	{0x4000c132, 0x00000000}, /* MP_GPIO_CTRL3 */
	{0x4000c133, 0x00000000}, /* MP_GPIO_CTRL4 */
	{0x4000c134, 0x00000005}, /* DMIC_CLK_CTRL */
	{0x4000c135, 0x00000005}, /* DMIC01_CTRL */
	{0x4000c136, 0x00000005}, /* DMIC23_CTRL */
	{0x4000c137, 0x00000005}, /* BCLK0_CTRL */
	{0x4000c138, 0x00000005}, /* FSYNC0_CTRL */
	{0x4000c139, 0x00000005}, /* SDATAO0_CTRL */
	{0x4000c13a, 0x00000005}, /* SDATAI0_CTRL */
	{0x4000c13b, 0x00000005}, /* BCLK1_CTRL */
	{0x4000c13c, 0x00000005}, /* FSYNC1_CTRL */
	{0x4000c13d, 0x00000005}, /* SDATAO1_CTRL */
	{0x4000c13e, 0x00000005}, /* SDATAI1_CTRL */
	{0x4000c13f, 0x00000005}, /* QSPIM_CLK_CTRL */
	{0x4000c140, 0x00000005}, /* QSPIM_CS_CTRL */
	{0x4000c141, 0x00000005}, /* QSPIM_SDIO0_CTRL */
	{0x4000c142, 0x00000005}, /* QSPIM_SDIO1_CTRL */
	{0x4000c143, 0x00000005}, /* QSPIM_SDIO2_CTRL */
	{0x4000c144, 0x00000025}, /* QSPIM_SDIO3_CTRL */
	{0x4000c145, 0x00000025}, /* UART_COMM_TX_CTRL */
	{0x4000c146, 0x00000025}, /* UART_COMM_RX_CTRL */
	{0x4000c147, 0x00000005}, /* SELFBOOT_CTRL */
	{0x4000c148, 0x00000005}, /* IRQ_CTRL */
	{0x4000c149, 0x00000005}, /* ROM_BOOT_MODE_CTRL */
	{0x4000c14a, 0x00000015}, /* TCK_CTRL */
	{0x4000c14b, 0x00000035}, /* TMS_CTRL */
	{0x4000c14c, 0x00000005}, /* TDO_CTRL */
	{0x4000c14d, 0x00000035}, /* TDI_CTRL */
	{0x4000c14e, 0x00000000}, /* I2C_SPI_CTRL */
	{0x4000c150, 0x00000000}, /* IRQ_CTRL1 */
	{0x4000c151, 0x0000007F}, /* IRQ1_MASK1 */
	{0x4000c152, 0x000000F7}, /* IRQ1_MASK2 */
	{0x4000c153, 0x0000003F}, /* IRQ1_MASK3 */
	{0x4000c154, 0x0000003F}, /* IRQ1_MASK4 */
	{0x4000c155, 0x0000000F}, /* IRQ1_MASK5 */
	{0x4000c156, 0x0000007F}, /* IRQ2_MASK1 */
	{0x4000c157, 0x000000F7}, /* IRQ2_MASK2 */
	{0x4000c158, 0x0000003F}, /* IRQ2_MASK3 */
	{0x4000c159, 0x0000003F}, /* IRQ2_MASK4 */
	{0x4000c15a, 0x0000000F}, /* IRQ2_MASK5 */
	{0x4000c15b, 0x0000007F}, /* IRQ3_MASK1 */
	{0x4000c15c, 0x000000F7}, /* IRQ3_MASK2 */
	{0x4000c15d, 0x0000003F}, /* IRQ3_MASK3 */
	{0x4000c15e, 0x0000003F}, /* IRQ3_MASK4 */
	{0x4000c15f, 0x0000000F}, /* IRQ3_MASK5 */
	{0x4000c160, 0x0000007F}, /* IRQ4_MASK1 */
	{0x4000c161, 0x000000F7}, /* IRQ4_MASK2 */
	{0x4000c162, 0x0000003F}, /* IRQ4_MASK3 */
	{0x4000c163, 0x0000003F}, /* IRQ4_MASK4 */
	{0x4000c164, 0x0000000F}, /* IRQ4_MASK5 */
	{0x4000c165, 0x00000000}, /* SW_INT */
	{0x4000c169, 0x00000000}, /* MP_INPUT_IRQ_CTRL2 */
	{0x4000c16a, 0x000000FF}, /* MP_INPUT_IRQ1_MASK1 */
	{0x4000c16b, 0x000000FF}, /* MP_INPUT_IRQ1_MASK2 */
	{0x4000c16c, 0x000000FF}, /* MP_INPUT_IRQ1_MASK3 */
	{0x4000c16d, 0x00000003}, /* MP_INPUT_IRQ1_MASK4 */
	{0x4000c16e, 0x000000FF}, /* MP_INPUT_IRQ2_MASK1 */
	{0x4000c16f, 0x000000FF}, /* MP_INPUT_IRQ2_MASK2 */
	{0x4000c170, 0x000000FF}, /* MP_INPUT_IRQ2_MASK3 */
	{0x4000c171, 0x00000003}, /* MP_INPUT_IRQ2_MASK4 */
	{0x4000c172, 0x000000FF}, /* MP_INPUT_IRQ3_MASK1 */
	{0x4000c173, 0x000000FF}, /* MP_INPUT_IRQ3_MASK2 */
	{0x4000c174, 0x000000FF}, /* MP_INPUT_IRQ3_MASK3 */
	{0x4000c175, 0x00000003}, /* MP_INPUT_IRQ3_MASK4 */
	{0x4000c1d0, 0x00000001}, /* FDSP_MODE */
	{0x4000cc04, 0x00000000}, /* DAC_NOISE_CTRL2 */
	{0x4000cc12, 0x00000000}, /* DAC_NOISE_CTRL1 */
};

// post-memory registers
uint32_t reg_post[5][2] =
{
    {0x4000c008, 0x00000001}, /* DSP_PWR */
	{0x4000c00e, 0x00000007}, /* CHIP_PWR */
	{0x4000c004, 0x00000001}, /* ADC_DAC_HP_PWR */
	{0x4000c051, 0x00000004}, /* DAC_CTRL2 */
	{0x4000c052, 0x00000081}, /* DAC_VOL0 */
};


/*!
* FDSP Address of memories on Lark:
* Program: "0x40008000"
* Bank A:  [
*    "0x40008100",
*    "0x40008200",
*    "0x40008300",
*    "0x40008400",
*    "0x40008500"
* ]
* Bank B:  [
*    "0x40008600",
*    "0x40008700",
*    "0x40008800",
*    "0x40008900",
*    "0x40008A00"
* ]
* Bank C:  [
*    "0x40008B00",
*    "0x40008C00",
*    "0x40008D00",
*    "0x40008E00",
*    "0x40008F00"
* ]
*/

// dsp_programme_es20_master_slave_v7_RBS_27nov24_MOD_Dec6_fdsp
 
uint32_t fdsp_program[75] =
{
    0x00824800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B25000, 0x0082C800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B25200, 0x01804800, 0x04805400, 0x01804800, 0x04805600, 0x00844800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B25800, 0x0084C800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B25A00, 0x01804800, 0x04805C00, 0x01C04800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x01804800, 0x04805E00, 0x00B7C800, 0x00B26000, 0x01C04800, 0x01806200, 0x01C04800, 0x04800000, 0x01C04800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x00B24800, 0x01804800, 0x04806400, 0x00B94800, 0x00B26600, 0x01C04800, 0x01806800, 0x04806A00, 0x01C04800, 0x04800200, 0x01C04800, 0x04800400, 0x00000000, 0x00000000
};

uint32_t fdsp_param_bank_a[5][75] =
{
    {0x081471CE, 0x0000C834, 0x0805C89E, 0x07F873A4, 0x07FB82B4, 0x0803F9FC, 0x07C10D2E, 0x08000000, 0x08051A99, 0x081C473D, 0x0800B545, 0x06ACFDF7, 0x00A5E098, 0x0803CCFE, 0x0803CCFE, 0x194C57E2, 0x0DF00000, 0xC8000000, 0x0FF00000, 0xC8000000, 0x081471CE, 0x0000C834, 0x0805C89E, 0x07F873A4, 0x07FB82B4, 0x0803F9FC, 0x07C10D2E, 0x08000000, 0x08051A99, 0x081C473D, 0x0800B545, 0x06ACFDF7, 0x00A5E098, 0x0803CCFE, 0x0803CCFE, 0x194C57E2, 0x01F00000, 0xC8000000, 0x80300000, 0x141C837B, 0x0801BDBB, 0x07FBA088, 0x0803CCFE, 0x081F252C, 0x08362F93, 0x0BE7D930, 0xC9F00000, 0xC8000000, 0x0819C63E, 0x006CB9A1, 0xE1BF66D0, 0xC9F00000, 0xE3AF7000, 0xC8000000, 0x1B040000, 0x096C8956, 0x080393AD, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0xC9F00000, 0xC8000000, 0x0842BBA5, 0x006CB9A1, 0xE7CB4690, 0xC9F00000, 0xDC000000, 0xE9ABA800, 0xC8000000, 0xEBAF5000, 0xC8000000, 0x00000000, 0x00000000},
    {0xF042CA0E, 0x00019068, 0xF0095912, 0xF019A6A5, 0xF0394411, 0xF018F8B9, 0xF0D3D39A, 0x00000000, 0xF003B687, 0xF00E980A, 0xF0036EEA, 0xF2D9356D, 0xFF1ADF2F, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xF042CA0E, 0x00019068, 0xF0095912, 0xF019A6A5, 0xF0394411, 0xF018F8B9, 0xF0D3D39A, 0x00000000, 0xF003B687, 0xF00E980A, 0xF0036EEA, 0xF2D9356D, 0xFF1ADF2F, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0xD7DA098F, 0xF0087D8C, 0xF02ADED7, 0xF0407534, 0xF1032342, 0xF139E541, 0xEE031C96, 0x00000000, 0x00000000, 0xF0037EE9, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0xED5D9329, 0xF040AA6C, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0xF008FA85, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x07AC1632, 0x0000C834, 0x07F0E75F, 0x07EF9FD3, 0x07CBE0B9, 0x07E7072A, 0x079FB431, 0x00000000, 0x07F73208, 0x07D540F3, 0x07FBDC88, 0x0696D9E5, 0x004BDA8F, 0x07BDE6AF, 0x07BDE6AF, 0x00000000, 0x00014700, 0x00000000, 0x00014700, 0x00000000, 0x07AC1632, 0x0000C834, 0x07F0E75F, 0x07EF9FD3, 0x07CBE0B9, 0x07E7072A, 0x079FB431, 0x00000000, 0x07F73208, 0x07D540F3, 0x07FBDC88, 0x0696D9E5, 0x004BDA8F, 0x07BDE6AF, 0x07BDE6AF, 0x00000000, 0x00014700, 0x00000000, 0x08000000, 0x14097BFB, 0x07F5D154, 0x07D9D986, 0x07BDE6AF, 0x06F04831, 0x06C31E6B, 0x073FE1A9, 0x00014700, 0x00000000, 0x07E2C67A, 0x00000000, 0x08000000, 0x00014700, 0x08000000, 0x00000000, 0x08000000, 0x094CF881, 0x07BDEAC1, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x00014700, 0x00000000, 0x07B45574, 0x00000000, 0x08000000, 0x00014700, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x0FBE3CA3, 0x0FB4C3D1, 0x0FF6AA8E, 0x0FE6595B, 0x0FC6BBEF, 0x0FE70747, 0x0F2C2C66, 0x00000000, 0x0FFC4979, 0x0FF167F6, 0x0FFC9144, 0x0D26CA93, 0x0E8D01C0, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0FBE3CA3, 0x0FB4C3D1, 0x0FF6AA8E, 0x0FE6595B, 0x0FC6BBEF, 0x0FE70747, 0x0F2C2C66, 0x00000000, 0x0FFC4979, 0x0FF167F6, 0x0FFC9144, 0x0D26CA93, 0x0E8D01C0, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0FFBBC45, 0x0FF78274, 0x0FD52129, 0x0FBF8ACC, 0x0EFCDCBE, 0x0EC61ABF, 0x0B225871, 0x00000000, 0x00000000, 0x0FFC8117, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x0FD6C72E, 0x0FBF5594, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x0FF7057B, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0xF8407EB0, 0xF8481B5F, 0xF80953A3, 0xF817EC89, 0xF8389C93, 0xF814FEDA, 0xF89F3EA0, 0x00000000, 0xF803B35F, 0xF80E77D0, 0xF8036E60, 0xFABC2824, 0xF96663EB, 0xF83E4C52, 0xF83E4C52, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0xF8407EB0, 0xF8481B5F, 0xF80953A3, 0xF817EC89, 0xF8389C93, 0xF814FEDA, 0xF89F3EA0, 0x00000000, 0xF803B35F, 0xF80E77D0, 0xF8036E60, 0xFABC2824, 0xF96663EB, 0xF83E4C52, 0xF83E4C52, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0xF8044298, 0xF80870F0, 0xF82A85F1, 0xF83E4C52, 0xF8F092A3, 0xF906B202, 0xFBB2D01F, 0x08000000, 0x00000000, 0xF8037347, 0x00000000, 0x08000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0xF8159A45, 0xF83E8191, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0x08000000, 0x00000000, 0xF808EEE7, 0x00000000, 0x08000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000}
};

uint32_t fdsp_param_bank_b[5][75] =
{
    {0x07FE6DED, 0x08065262, 0x080ACCC5, 0x0816213F, 0x07D1517A, 0x05E71F35, 0x07F795B7, 0xC4022AB3, 0x08051A99, 0x081C473D, 0x0800B545, 0x06ACFDF7, 0x00A5E098, 0x08000000, 0x0803CCFE, 0x194C583A, 0x0DF00000, 0xC8000000, 0x0FF00000, 0xC8000000, 0x07FE6DED, 0x08065262, 0x080ACCC5, 0x0816213F, 0x07D1517A, 0x05E71F35, 0x07F795B7, 0xC4022AB3, 0x08051A99, 0x081C473D, 0x0800B545, 0x06ACFDF7, 0x00A5E098, 0x08000000, 0x0803CCFE, 0x194C57E2, 0x01F00000, 0xC8000000, 0x80300000, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0xC9F00000, 0xC8000000, 0x08000000, 0x02636807, 0xE1BF66D0, 0xC9F00000, 0xE3AF7000, 0xC8000000, 0x1B040000, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0xC9F00000, 0xC8000000, 0x08000000, 0x02636807, 0xE7CB4690, 0xC9F00000, 0xDC000000, 0xE9ABA800, 0xC8000000, 0xEBAF5000, 0xC8000000, 0x00000000, 0x00000000},
    {0xF005A1F1, 0xF014833C, 0xF019DB49, 0xF04BC1B8, 0xF0BD6D4C, 0xF61747C6, 0xF02F104C, 0x00000000, 0xF003B687, 0xF00E980A, 0xF0036EEA, 0xF2D9356D, 0xFF1ADF2F, 0x00000000, 0xF0407534, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xF005A1F1, 0xF014833C, 0xF019DB49, 0xF04BC1B8, 0xF0BD6D4C, 0xF61747C6, 0xF02F104C, 0x00000000, 0xF003B687, 0xF00E980A, 0xF0036EEA, 0xF2D9356D, 0xFF1ADF2F, 0x00000000, 0xF0407534, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x07FBF0BE, 0x07E575E2, 0x07DF7F5D, 0x07BD6652, 0x07A623D5, 0x05C40ED4, 0x07DACF4C, 0x00000000, 0x07F73208, 0x07D540F3, 0x07FBDC88, 0x0696D9E5, 0x004BDA8F, 0x00000000, 0x07BDE6AF, 0x00000000, 0x00014700, 0x00000000, 0x00014700, 0x00000000, 0x07FBF0BE, 0x07E575E2, 0x07DF7F5D, 0x07BD6652, 0x07A623D5, 0x05C40ED4, 0x07DACF4C, 0x00000000, 0x07F73208, 0x07D540F3, 0x07FBDC88, 0x0696D9E5, 0x004BDA8F, 0x00000000, 0x07BDE6AF, 0x00000000, 0x00014700, 0x00000000, 0x08000000, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x00014700, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00014700, 0x08000000, 0x00000000, 0x08000000, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x00014700, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00014700, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x0FFA5E0F, 0x0FEB9419, 0x0FE624B7, 0x0FB43E48, 0x0F4292B4, 0x09E8B83A, 0x0FD0EFB4, 0x00000000, 0x0FFC4979, 0x0FF167F6, 0x0FFC9144, 0x0D26CA93, 0x0E8D01C0, 0x00000000, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0FFA5E0F, 0x0FEB9419, 0x0FE624B7, 0x0FB43E48, 0x0F4292B4, 0x09E8B83A, 0x0FD0EFB4, 0x00000000, 0x0FFC4979, 0x0FF167F6, 0x0FFC9144, 0x0D26CA93, 0x0E8D01C0, 0x00000000, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0xF805A155, 0xF8144F10, 0xF815B3DD, 0xF82C786F, 0xF8888AB1, 0xFC54D1F6, 0xF82D9AFD, 0x00000000, 0xF803B35F, 0xF80E77D0, 0xF8036E60, 0xFABC2824, 0xF96663EB, 0x00000000, 0xF83E4C52, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0xF805A155, 0xF8144F10, 0xF815B3DD, 0xF82C786F, 0xF8888AB1, 0xFC54D1F6, 0xF82D9AFD, 0x00000000, 0xF803B35F, 0xF80E77D0, 0xF8036E60, 0xFABC2824, 0xF96663EB, 0x00000000, 0xF83E4C52, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000}
};

uint32_t fdsp_param_bank_c[5][75] =
{
    {0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0DF00000, 0xC8000000, 0x0FF00000, 0xC8000000, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x01F00000, 0xC8000000, 0x80300000, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0xC9F00000, 0xC8000000, 0x0803CCFE, 0x0803CCFE, 0xE1BF66D0, 0xC9F00000, 0xE3AF7000, 0xC8000000, 0x1B040000, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0x0803CCFE, 0xC9F00000, 0xC8000000, 0x0803CCFE, 0x0803CCFE, 0xE7CB4690, 0xC9F00000, 0xDC000000, 0xE9ABA800, 0xC8000000, 0xEBAF5000, 0xC8000000, 0x00000000, 0x00000000},
    {0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0x08000000, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0xF0407534, 0xF0407534, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0xF0407534, 0x00000000, 0x00000000, 0xF0407534, 0xF0407534, 0x08000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x00014700, 0x00000000, 0x00014700, 0x00000000, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x00014700, 0x00000000, 0x08000000, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x00014700, 0x00000000, 0x07BDE6AF, 0x07BDE6AF, 0x08000000, 0x00014700, 0x08000000, 0x00000000, 0x08000000, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x07BDE6AF, 0x00014700, 0x00000000, 0x07BDE6AF, 0x07BDE6AF, 0x08000000, 0x00014700, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x0FBF8ACC, 0x0FBF8ACC, 0x00000000, 0x00000000, 0x00000000, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000},
    {0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0x08000000, 0x00000000, 0x08000000, 0x00000000, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0x08000000, 0x00000000, 0x00000000, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0x08000000, 0x00000000, 0xF83E4C52, 0xF83E4C52, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0xF83E4C52, 0x08000000, 0x00000000, 0xF83E4C52, 0xF83E4C52, 0x00000000, 0x08000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000}
};

#endif // #define MICROPHONE_TESTING
// .............................................................................



// .............................................................................
// DSP SPI callback function
// .............................................................................
void DSP_SPI_CALLBACK(uintptr_t context)
{
    SPI_SS_Set();
}

// .............................................................................
// DSP SPI transfer function.
// Call this to initiate read or write (after setting up buffer etc.))
// .............................................................................
void dsp_xfer(uint8_t *wrbuf, uint8_t *rdbuf, uint len)
{
    SPI_SS_Clear();
    //SERCOM0_SPI_WriteRead (wrbuf, len, rdbuf, len);
}

// .............................................................................
// DSP Write function
// Inputs:
//  addr:   DSP register address to start write at
//  wrbuf:  Start of data buffer containing the data to write
//  len:    Number of bytes to write
// .............................................................................
void dsp_write(uint32_t addr, const uint8_t *wrbuf, uint len)
{
    if (len > 256) len = 256;
    dsp_wrbuf[0] = 0x00; // write transaction
    dsp_wrbuf[1] = addr >> 24; // 32bit address
    dsp_wrbuf[2] = addr >> 16;
    dsp_wrbuf[3] = addr >> 8;
    dsp_wrbuf[4] = addr;
    dsp_wrbuf[5] = 0x00; // dummy
    for (uint i = 0; i < len; i++) {
        dsp_wrbuf[6+i] = wrbuf[i];
    }
    dsp_xfer(dsp_wrbuf, dsp_rdbuf, 6+len);
}

// .............................................................................
// DSP Read function
// Inputs:
//  addr:   DSP register address to start read at
//  rdbuf:  Start of data buffer to copy the read data to
//  len:    Number of bytes to read
// .............................................................................
void dsp_read(uint32_t addr, uint8_t *rdbuf, uint len)
{
    if (len > 256) len = 256;
    dsp_wrbuf[0] = 0x01; // read transaction
    dsp_wrbuf[1] = addr >> 24; // 32bit address
    dsp_wrbuf[2] = addr >> 16;
    dsp_wrbuf[3] = addr >> 8;
    dsp_wrbuf[4] = addr;
    dsp_wrbuf[5] = 0x00; // dummy
    for (uint i = 0; i < len; i++) {
        dsp_wrbuf[6+i] = 0x00; // dummy
    }
    dsp_xfer(dsp_wrbuf, dsp_rdbuf, 6+len);
    memcpy(rdbuf, dsp_rdbuf+6, len);
}

// .............................................................................
// Initialise DSP SPI for reading/writing
// .............................................................................
uint8_t dsp_init()
{
    uint8_t buf[1];
   // SERCOM0_SPI_CallbackRegister(DSP_SPI_CALLBACK, 0); 
    dsp_read(0x4000C000, buf, 1);
    osDelayMs(2);
    dsp_read(0x4000C000, buf, 1);
    osDelayMs(2);
    dsp_read(0x4000C000, buf, 1);
    osDelayMs(20);
    dsp_read(0x4000C000, buf, 1);
    return buf[0];
}

// .............................................................................
// Disable DSP
// Only used as part of the test sequence on power up.
// .............................................................................
void dsp_disable_spi()
{
    PORT_REGS->GROUP[1].PORT_PINCFG[24] = 0x00;
    PORT_REGS->GROUP[1].PORT_PINCFG[25] = 0x00;  
    PORT_REGS->GROUP[2].PORT_PINCFG[25] = 0x00;
    
    SPI_SS_InputEnable();
}

// .............................................................................
// Enable DSP
// Only used as part of the test sequence on power up.
// .............................................................................
void dsp_enable_spi()
{
    
    PORT_REGS->GROUP[1].PORT_PINCFG[24] = 0x01; // PB24=MOSI Func.C(0x02)
    PORT_REGS->GROUP[1].PORT_PINCFG[25] = 0x01; // PB25=SCLK Func.C(0x02)
    PORT_REGS->GROUP[2].PORT_PINCFG[25] = 0x01; // PC25=MISO Func.C(0x02)
    PORT_REGS->GROUP[1].PORT_PMUX[12] = 0x22;  
    PORT_REGS->GROUP[2].PORT_PMUX[12] = 0x20;

    SPI_SS_OutputEnable();
    SPI_SS_Set();
}

// .............................................................................
// Power up the DSP
// Only used when resetting the DSP on power up.
// .............................................................................
void dsp_pwr_up() 
{ 
    ADAU1860_PD_Set(); 
}

// .............................................................................
// Power down the DSP
// Only used when resetting the DSP on power up.
// .............................................................................
void dsp_pwr_dn() 
{ 
    ADAU1860_PD_Clear(); 
}

// .............................................................................
// Reset the DSP.
// This is the required power down/up sequence to reset the DSP.
// .............................................................................
void dsp_reset(uint ms)
{
    dsp_pwr_dn();
    osDelayMs(ms);
    dsp_pwr_up();
}


// .............................................................................
// DSP read.write functions
// TODO: Check the descriptions below
// .............................................................................

// .............................................................................
// Write a block of data (to several registers)
// .............................................................................

void adi_lark_hal_mem_write(uint32_t address, uint8_t * data_to_write, uint32_t len )
{   
    dsp_write( address, data_to_write, len);
}

// .............................................................................
// Write to one register
// .............................................................................
void adi_lark_hal_reg_write(uint32_t address, uint32_t data_to_write)
{
    dsp_write( address, (uint8_t *) &data_to_write, 1);
}

// .............................................................................
// read one register
// .............................................................................
void  adi_lark_hal_reg_read(uint32_t address, uint32_t * data_to_read)
{
    dsp_read( address, (uint32_t *) data_to_read, 4);
}
// .............................................................................
// Update register bit(s)
// .............................................................................
void adi_lark_hal_bf_write( uint32_t reg_addr, uint32_t bf_info, uint32_t bf_val )
{
    uint32_t reg_value, reg_temp, reg_mask;
    int32_t  reg_count, i;
    uint8_t  bit_start = bf_info;
    uint8_t  bit_count = bf_info >> 8;    

    if(reg_addr >= LARK_8BIT_REG_ADDR_START && reg_addr <= LARK_8BIT_REG_ADDR_END)
    {
        if ((bit_count == 8) && (bit_start == 0))
        {
            adi_lark_hal_reg_write(reg_addr, bf_val);
        }
        else
        {
            reg_value = 0;
            reg_count = ((bit_start + bit_count) >> 3) + ((((bit_start + bit_count) & 7) > 0) ? 1 : 0);
            for(i = 0; i < reg_count; i++)
            {
                adi_lark_hal_reg_read(reg_addr + i, &reg_temp);
                reg_value += reg_temp << (i * 8);
            }
            reg_mask = (bit_count == 32) ? 0xffffffff : ((1 << bit_count) - 1);
            reg_value &= ~(reg_mask << bit_start);
            reg_value |=  (bf_val   << bit_start);
            for(i = 0; i < reg_count; i++)
            {
                adi_lark_hal_reg_write(reg_addr + i, (reg_value >> (i * 8)) & 0xff);
            }
        }
    }
    else
    {
        if ((bit_count == 32) && (bit_start == 0))
        {
            adi_lark_hal_reg_write(reg_addr, bf_val);
        }
        else
        {
            adi_lark_hal_reg_read(reg_addr, &reg_value);
            if((bit_count + bit_start) <= 32)
            {
                reg_mask = (bit_count == 32) ? 0xffffffff : ((1 << bit_count) - 1);
                reg_value &= ~(reg_mask << bit_start);
                reg_value |=  (bf_val   << bit_start);
                adi_lark_hal_reg_write(reg_addr, reg_value);
            }
            else
            {
                reg_mask = 0xffffffff;
                reg_value &= ~(reg_mask << bit_start);
                reg_value |=  (bf_val   << bit_start);
                adi_lark_hal_reg_write(reg_addr, reg_value);
                adi_lark_hal_reg_read(reg_addr + 4, &reg_value);
                reg_mask = (1 << (bit_count - (32 - bit_start))) - 1;
                reg_value &= ~reg_mask;
                reg_value |= (bf_val >> (32 - bit_start));
                adi_lark_hal_reg_write(reg_addr, reg_value);
                //LARK_ERROR_RETURN(err);
            }
        }
    }
}

// .............................................................................
// DSP - enable Power On
// .............................................................................
void adi_lark_fdsp_enable_power_on(bool enable)
{
    adi_lark_hal_bf_write(BF_FDSP_EN_INFO, enable ? 1 : 0);
}

// .............................................................................
// DSP - enable Run
// .............................................................................
void adi_lark_fdsp_enable_run(bool enable)
{
    adi_lark_hal_bf_write(BF_FDSP_RUN_INFO, enable ? 1 : 0);
}

// .............................................................................
// DSP - select Parameter Bank
// .............................................................................
void adi_lark_fdsp_select_param_bank(adi_lark_fdsp_param_bank_e sel)
{
    adi_lark_hal_bf_write(BF_FDSP_BANK_SEL_INFO, sel);
}

// .............................................................................
// Update DSP, by updating (writing) all the register arrays and the ANC mode.
// .............................................................................
int32_t adi_lark_load_fdsp(void)
{
    uint32_t err;
    uint8_t i;
    uint8_t fdsp_instructions;

    /* power fdsp */
    adi_lark_fdsp_enable_power_on(true);
    //LARK_ERROR_RETURN(err);

    /* stop fdsp before programming */
    adi_lark_fdsp_enable_run(false);

    fdsp_instructions = sizeof(fdsp_program)/sizeof(uint32_t);
    
    if (fdsp_instructions  > 64 )
    {
         
    	/* write program memory*/
    	adi_lark_hal_mem_write(LARK_FDSP_PROGRAM_MEM_BASE, (uint8_t *)fdsp_program, 256);
        
		// write program memory
		adi_lark_hal_mem_write(LARK_FDSP_PROGRAM_T_MEM_BASE, (uint8_t *)fdsp_program + 256, sizeof(fdsp_program) - 256); // Llega hasta aqu? revisar paso a paso

        // write parameter bank A
		for (i = 0; i < 5; i++)
		{
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_BANKA_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_a[i], 256);
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_T_BANKA_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_a[i] + 256, sizeof(fdsp_param_bank_a[i]) - 256);
		}
		
        // write parameter bank B
		for (i = 0; i < 5; i++)
		{
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_BANKB_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_b[i], 256);
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_T_BANKB_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_b[i] + 256, sizeof(fdsp_param_bank_b[i]) - 256);
		}

		// write parameter bank C 
		for (i = 0; i < 5; i++)
		{
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_BANKC_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_c[i], 256);
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_T_BANKC_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_c[i] + 256, sizeof(fdsp_param_bank_c[i]) - 256);
		}
        
    }else
    {

        // write program memory
    	adi_lark_hal_mem_write(LARK_FDSP_PROGRAM_MEM_BASE, (uint8_t *)fdsp_program, sizeof(fdsp_program));

		// write parameter bank A 
		for (i = 0; i < 5; i++)
		{
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_BANKA_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_a[i], sizeof(fdsp_param_bank_a[i]));
		}

		// write parameter bank B
		for (i = 0; i < 5; i++)
		{
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_BANKB_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_b[i], sizeof(fdsp_param_bank_b[i]));
		}

		// write parameter bank C 
		for (i = 0; i < 5; i++)
		{
			adi_lark_hal_mem_write(LARK_FDSP_PARAM_BANKC_BASE + LARK_FDSP_PARAM_SPAN * i, (uint8_t *)fdsp_param_bank_c[i], sizeof(fdsp_param_bank_c[i]));
		}


    }

    
    
    //select parameter bank 
    // adi_lark_fdsp_select_param_bank(API_LARK_FDSP_PARAM_BANK_A);
    dsp_anc_mode_set(dsp_anc_mode);
    adi_lark_fdsp_enable_run(true);
    
    return 0;
}


// .............................................................................
// Load pre-registers
// .............................................................................
void adi_lark_load_pre_reg(void)
{
    uint32_t i;
    uint32_t size = sizeof(reg_pre)/8;

    for (i = 0; i < size; i++)
    {
        adi_lark_hal_reg_write(reg_pre[i][0], reg_pre[i][1]);
    }
}

// .............................................................................
// Load post-registers
// .............................................................................
void adi_lark_startup(void)
{
    uint32_t i;
    uint32_t size = sizeof(reg_post)/8;

    for (i = 0; i < size; i++)
    {
        adi_lark_hal_reg_write(reg_post[i][0], reg_post[i][1]);
    }
}

// .............................................................................
// Switch to new ANC Mode
// .............................................................................

#ifdef MICROPHONE_TESTING

void dsp_anc_mode_set(uint8_t mode)
{
    if (mode == dsp_anc_mode)
    {
        // Nothing to do
        return;
    }
    // Switch to next mode
    switch (mode) 
    {
        case DMICS_ALL_OFF:
            
            dsp_anc_mode = DMICS_ALL_OFF;
            
            fdsp_param_bank_a[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC0_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC1_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC2_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC3_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC4_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC5_MUTE] = 0x00000000;

            break;
        
        case DMIC0_ON:
        
            dsp_anc_mode = DMIC0_ON;
            
            fdsp_param_bank_a[4][DMIC0_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC0_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC0_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC1_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC2_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC3_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC4_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC5_MUTE] = 0x00000000;

            break;
            
        case DMIC1_ON:

            dsp_anc_mode = DMIC1_ON;
            
            fdsp_param_bank_a[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC0_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC1_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC1_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC1_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC2_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC3_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC4_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC5_MUTE] = 0x00000000;

            break;

        case DMIC2_ON:

            dsp_anc_mode = DMIC2_ON;
            
            fdsp_param_bank_a[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC0_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC1_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC2_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC2_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC2_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC3_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC4_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC5_MUTE] = 0x00000000;

            break;

        case DMIC3_ON:

            dsp_anc_mode = DMIC3_ON;

            fdsp_param_bank_a[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC0_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC1_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC2_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC3_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC3_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC3_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC4_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC5_MUTE] = 0x00000000;

            break;

        case DMIC4_ON:

            dsp_anc_mode = DMIC4_ON;

            fdsp_param_bank_a[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC0_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC1_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC2_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC3_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC4_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC4_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC4_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC5_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC5_MUTE] = 0x00000000;

            break;

        case DMIC5_ON:

            dsp_anc_mode = DMIC5_ON;

            fdsp_param_bank_a[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC0_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC0_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC1_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC1_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC2_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC2_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC3_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC3_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_b[4][DMIC4_MUTE] = 0x00000000;
            fdsp_param_bank_c[4][DMIC4_MUTE] = 0x00000000;
            
            fdsp_param_bank_a[4][DMIC5_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC5_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC5_MUTE] = 0x08000000;

            break;

        case DMICS_ALL_ON:

            dsp_anc_mode = DMICS_ALL_ON;

            fdsp_param_bank_a[4][DMIC0_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC0_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC0_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC1_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC1_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC1_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC2_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC2_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC2_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC3_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC3_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC3_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC4_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC4_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC4_MUTE] = 0x08000000;
            
            fdsp_param_bank_a[4][DMIC5_MUTE] = 0x08000000;
            fdsp_param_bank_b[4][DMIC5_MUTE] = 0x08000000;
            fdsp_param_bank_c[4][DMIC5_MUTE] = 0x08000000;

            break;

        default:
            // error
            break;
    }
    
    adi_lark_load_fdsp();
}
#else

void dsp_anc_mode_set(uint8_t mode)
{
    if (mode == dsp_anc_mode)
    {
        // Nothing to do
        return;
    }
    // Switch to next mode
    switch (mode) 
    {
        case DSP_ANC_MODE_NOISE_CANCELATION:
            dsp_anc_mode = DSP_ANC_MODE_NOISE_CANCELATION;
            adi_lark_fdsp_select_param_bank(API_LARK_FDSP_PARAM_BANK_A);
            break;
        case DSP_ANC_MODE_TRANSPARENT:
            dsp_anc_mode = DSP_ANC_MODE_TRANSPARENT;
            adi_lark_fdsp_select_param_bank(API_LARK_FDSP_PARAM_BANK_B);
            break;
        case DSP_ANC_MODE_NORMAL:
            dsp_anc_mode = DSP_ANC_MODE_NORMAL;
            adi_lark_fdsp_select_param_bank(API_LARK_FDSP_PARAM_BANK_C);
            break;
        default:
            // error
            break;
    }
}

#endif // MICROPHONE_TESTING

// .............................................................................


// .............................................................................
// Cycle to the next ANC Mode
//  Noise Cancelation -> Transparent -> Normal -> ANC
// .............................................................................

#ifdef MICROPHONE_TESTING

void dsp_anc_mode_cycle()
{
    switch (dsp_anc_mode) 
    {
        case DMICS_ALL_OFF:
            dsp_anc_mode_set(DMIC0_ON);
            break;
        case DMIC0_ON:
            dsp_anc_mode_set(DMIC1_ON);
            break;
        case DMIC1_ON:
            dsp_anc_mode_set(DMIC2_ON);
            break;
        case DMIC2_ON:
            dsp_anc_mode_set(DMIC3_ON);
            break;
        case DMIC3_ON:
            dsp_anc_mode_set(DMIC4_ON);
            break;
        case DMIC4_ON:
            dsp_anc_mode_set(DMIC5_ON);
            break;
        case DMIC5_ON:
            dsp_anc_mode_set(DMICS_ALL_ON);
            break;
        case DMICS_ALL_ON:
            dsp_anc_mode_set(DMICS_ALL_OFF);
            break;
       default:
            // error
            return;
    }
}




#else
void dsp_anc_mode_cycle()
{
    switch (dsp_anc_mode) 
    {
        case DSP_ANC_MODE_NOISE_CANCELATION:
            dsp_anc_mode_set(DSP_ANC_MODE_TRANSPARENT);
            break;
        case DSP_ANC_MODE_TRANSPARENT:
            dsp_anc_mode_set(DSP_ANC_MODE_NORMAL);
            break;
        case DSP_ANC_MODE_NORMAL:
            dsp_anc_mode_set(DSP_ANC_MODE_NOISE_CANCELATION);
            break;
        default:
            // error
            return;
    }
}
#endif // MICROPHONE_TESTING

// .............................................................................

// .............................................................................
// Select initial ANC Mode
// .............................................................................
void dsp_anc_mode_init()
{
    dsp_anc_mode_set(DSP_ANC_MODE_NOISE_CANCELATION);
}
// .............................................................................


// .............................................................................
// DSP Setup
// .............................................................................
void dsp_setup( void )
{
    
    // disable cache
// xthal_set_region_attribute((void *)0x40000000, 0x20000000, XCHAL_CA_BYPASS, XTHAL_CAFLAG_EXACT);

    // set REG_DAC_AUTO_MUTE_CTRL_ADDR to disable DAC auto-mute for easy debug
    adi_lark_hal_reg_write(0x4000C054, 0xFF);

    // load pre register
    adi_lark_load_pre_reg();

    // load fdsp memory, if fdsp is disabled, please skip the step
    adi_lark_load_fdsp();

    // load eq memory, if eq is disabled, please skip the step
//    err = adi_lark_test_load_eq(&device);
//    LARK_ERROR_RETURN(err);

    // startup lark
    adi_lark_startup();

}

// .............................................................................
// Using Boom Mic
// .............................................................................
void dsp_using_boom_mic()
{
    const uint32_t regs_using_boom_mic[5][2] =
    {
        {0x4000c0a3, 0x00000012}, /* ASRCO_CTRL */  	// Configure ASRCO_Input at 48KHz
        {0x4000c0a4, 0x00000020}, /* ASRCO_ROUTE0 */	// ASRCO_0 Out ADC0
        {0x4000c0a5, 0x00000020}, /* ASRCO_ROUTE1 */	// ASRCO_1 Out ADC0
        {0x4000c0e3, 0x00000024}, /* SPT0_ROUTE0 */		// SPT0 Slot0 Sending ADC0
        {0x4000c0e4, 0x00000024}, /* SPT0_ROUTE1 */		// SPT0 Slot1 Sending ADC0
    };
    
    uint32_t i;
    uint32_t size = sizeof(regs_using_boom_mic)/8;
    
    for (i = 0; i < size; i++)
    {
        adi_lark_hal_reg_write(regs_using_boom_mic[i][0], regs_using_boom_mic[i][1]);
    }
    VDD_MIC_EN_Set();
}
	
// .............................................................................
// Using Dmics
// .............................................................................
void dsp_using_dmics()
{
    const uint32_t regs_using_dmics[5][2] =
    {
        {0x4000c0a3, 0x00000014}, /* ASRCO_CTRL */		// Configure ASRCO_Input at 192KHz
        {0x4000c0a4, 0x00000025}, /* ASRCO_ROUTE0 */    // ASRCO Out DMIC2
        {0x4000c0a5, 0x00000026}, /* ASRCO_ROUTE1 */    // ASRCO Out DMIC3
        {0x4000c0e3, 0x0000002B}, /* SPT0_ROUTE0 */     // SPT0 Slot0 Sending FDEC0
        {0x4000c0e4, 0x0000002C}, /* SPT0_ROUTE1 */     // SPT0 Slot1 Sending FDEC1
    };
    
    uint32_t i;
    uint32_t size = sizeof(regs_using_dmics)/8;
    
    for (i = 0; i < size; i++)
    {
        adi_lark_hal_reg_write(regs_using_dmics[i][0], regs_using_dmics[i][1]);
    }
    VDD_MIC_EN_Clear();
}

// .............................................................................
// Both MICS off
// .............................................................................
void dsp_mute_all_mics()
{
    const uint32_t regs_mute_all_mics[5][2] =
    {
        {0x4000c0a3, 0x00000012}, /* ASRCO_CTRL */  	// Configure ASRCO_Input at 48KHz
        {0x4000c0a4, 0x00000002}, /* ASRCO_ROUTE0 */	// ASRCO_0 Out ADC0
        {0x4000c0a5, 0x00000002}, /* ASRCO_ROUTE1 */	// ASRCO_1 Out ADC0
        {0x4000c0e3, 0x0000003F}, /* SPT0_ROUTE0 */		// SPT0 Slot0 Sending ADC0
        {0x4000c0e4, 0x0000003F}, /* SPT0_ROUTE1 */		// SPT0 Slot1 Sending ADC0
    };
    
    uint32_t i;
    uint32_t size = sizeof(regs_mute_all_mics)/8;
    
    for (i = 0; i < size; i++)
    {
        adi_lark_hal_reg_write(regs_mute_all_mics[i][0], regs_mute_all_mics[i][1]);
    }
}


// .............................................................................
// Enable (unmute) the Talk Mics
// .............................................................................
void dsp_talk_mics_enable()
{
    // TODO: Modify the following code:
    
    #ifdef MICROPHONE_TESTING
    return;
    #endif // #define MICROPHONE_TESTING
    
    // Unmute the left talk mid
    fdsp_param_bank_a[4][L_TALK_MIC] = 0x08000000;
    fdsp_param_bank_b[4][L_TALK_MIC] = 0x08000000;
    fdsp_param_bank_c[4][L_TALK_MIC] = 0x08000000;
    // Unmute the right talk mid
    fdsp_param_bank_a[4][R_TALK_MIC] = 0x08000000;
    fdsp_param_bank_b[4][R_TALK_MIC] = 0x08000000;
    fdsp_param_bank_c[4][R_TALK_MIC] = 0x08000000;
    
    //load changed parameter bank
    adi_lark_load_fdsp();
    
}
// .............................................................................
// Disable (mute) the Talk Mics
// .............................................................................
void dsp_talk_mics_disable()
{
    // TODO: Modify the following code:
    
    #ifdef MICROPHONE_TESTING
    return;
    #endif // #define MICROPHONE_TESTING
    
    // Mute the left talk mid
    fdsp_param_bank_a[4][L_TALK_MIC] = 0x00000000;
    fdsp_param_bank_b[4][L_TALK_MIC] = 0x00000000;
    fdsp_param_bank_c[4][L_TALK_MIC] = 0x00000000;
    // Mute the right talk mid
    fdsp_param_bank_a[4][R_TALK_MIC] = 0x00000000;
    fdsp_param_bank_b[4][R_TALK_MIC] = 0x00000000;
    fdsp_param_bank_c[4][R_TALK_MIC] = 0x00000000;
    
    //load changed parameter bank
    adi_lark_load_fdsp();
}

// .............................................................................
// Enable (unmute) the Boom Mic
// .............................................................................
void dsp_boom_mic_enable()
{
     #ifdef MICROPHONE_TESTING
    return;
    #endif // #define MICROPHONE_TESTING
 
    // Unmute the left talk mid
    fdsp_param_bank_a[4][BOOM_MIC] = 0x08000000;
    fdsp_param_bank_b[4][BOOM_MIC] = 0x08000000;
    fdsp_param_bank_c[4][BOOM_MIC] = 0x08000000;
    
    //load changed parameter bank
    adi_lark_load_fdsp();
    
}
// .............................................................................
// Disable (mute) the Boom Mic
// .............................................................................
void dsp_boom_mic_disable()
{
    #ifdef MICROPHONE_TESTING
    return;
    #endif // #define MICROPHONE_TESTING

    // Unmute the left talk mid
    fdsp_param_bank_a[4][BOOM_MIC] = 0x00000000;
    fdsp_param_bank_b[4][BOOM_MIC] = 0x00000000;
    fdsp_param_bank_c[4][BOOM_MIC] = 0x00000000;
    
    //load changed parameter bank
    adi_lark_load_fdsp();
    
}
// .............................................................................
// Update EQ Values
// .............................................................................
void dsp_eq_presets_update()
{
//    uint8_t eq_vals[EQ_ARRAY_SIZE];
    uint8_t eq_vals[5];
    
    // Copy current EQ Preset values to eq_vals array
    json_eq_presets_read(eq_vals);
    
    // Update dsp filters....
    
}
// .............................................................................

// .............................................................................
// Task initializations.
// This function runs BEFORE task is created and scheduler started!.
// .............................................................................
void APP_DSP_Initialize ( void )
{
}


// .............................................................................
// DSP task.
// Initialise the DSP, load in the initial values to all register banks.
// Provides functions to allow the application to modify settings, 
// e.g. Microphone muting, AND Mode switching.
// .............................................................................
void APP_DSP_Tasks ( void )
{
    #ifndef DSP_DEBUGGER_ATTACHED
    uint8_t buf[4] = {0,0,0,0};
    
    // Task waits Power Task has powered everything up
    while (!GlobalPowerOn) {
        osDelayMs(100);
    }
    
    // Test sequence 
    dsp_disable_spi();
    osDelayMs(100);
    dsp_enable_spi();
    osDelayMs(100);
    dsp_reset(100);
    osDelayMs(100);
    // End Test sequence 
        
    // Initialise DSP
    buf[0] = dsp_init();
    DBGprintf("DSP init %02X\n", buf[0]);
    osDelayMs(1000);

    // Perform reads before enabling DSP
    dsp_read(0x4000C000, buf, 4);
    DBGprintf("DSP 0x4000C000 %02X %02X %02X %02X\n", buf[0], buf[1], buf[2], buf[3]);
    osDelayMs(100);        
    dsp_read(0x4000C000, buf, 4);
    DBGprintf("DSP 0x4000C000 %02X %02X %02X %02X\n", buf[0], buf[1], buf[2], buf[3]);
    
    // Power enable DSP
    osDelayMs(1000);        
    DBGprintf("FDSP power enable\n");
    buf[0] = 0x01;
    dsp_write(0x4000C008, buf, 4);

    
    
    // Test Code
    // Write to and read  back from DSP memory
    //osDelayMs(1000);        
    //printf("FDSP upload\n");
    //debug_dump_output((uint8_t *)eq_firmware, 16);
    //dsp_write(FDSP_BASE, eq_firmware, 16); // from internal flash
    
    //osDelayMs(1000);
    //printf("FDSP read back:\n");
    //dsp_read(FDSP_BASE, eq_buf, 16);
    //debug_dump_output(eq_buf, 16);

    //while(1) {
    //    osDelayMs(1000);
    //    dsp_read(0x4000C000, buf, 4);
    //    printf("DSP 0x4000C000 %02X %02X %02X %02X\n", buf[0], buf[1], buf[2], buf[3]);
    //}
    // End of Test Code
    
    dsp_setup();
    

    // Switch to default ANC mode
    dsp_anc_mode_init();
    
    while(1) {
        OS_SLEEP(10); //osDelayMs(10);
    }
    #endif // DSP_DEBUGGER_ATTACHED
}
// .............................................................................
